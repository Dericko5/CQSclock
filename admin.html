<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CQS | Admin</title>

  <style>
    /* ===============================
       Design tokens
       =============================== */
    :root{
      /* Base */
      --bg-start:#0a0a0a;
      --bg-end:#1a1a1a;
      --text:#ffffff;
      --muted:#9aa0a6;
      --hint:#cfd3d7;

      /* Brand (red) */
      --brand:#ff4d4f;     /* primary red */
      --brand-2:#d9363e;   /* darker red for gradient */
      --brand-glow: rgba(255,77,79,.30);

      /* Glass */
      --glass:rgba(255,255,255,.08);
      --glass-br:rgba(255,255,255,.15);
      --glass-hr:rgba(255,255,255,.20);

      /* Shadows */
      --shadow-soft: rgba(255,255,255,.08);
    }

    /* ===============================
       Base / Layout
       =============================== */
    *{ box-sizing:border-box; margin:0; padding:0; }

    body{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:linear-gradient(135deg,var(--bg-start),var(--bg-end));
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    }

    .wrap{ width:100%; max-width:480px; padding:24px; }

    .logo{
      font-weight:800;
      font-size:26px;
      text-align:center;
      color:var(--brand);
      text-shadow:0 0 18px var(--brand-glow);
    }

    .sub{
      color:var(--muted);
      text-align:center;
      margin:6px 0 18px;
    }

    .card{
      background:var(--glass);
      border:1px solid var(--glass-br);
      border-radius:16px;
      padding:18px;
      margin-bottom:14px;
      backdrop-filter:blur(10px);
    }

    /* ===============================
       Form controls
       =============================== */
    label{
      display:block;
      color:var(--hint);
      font-size:14px;
      margin:10px 0 8px;
    }

    input{
      width:100%;
      padding:14px;
      border-radius:10px;
      border:1px solid var(--glass-hr);
      background:rgba(255,255,255,.10);
      color:var(--text);
      margin-bottom:14px;
      outline:none;
      transition:border-color .2s, box-shadow .2s;
    }

    input:focus{
      border-color:var(--brand);
      box-shadow:0 0 8px var(--brand-glow);
    }

    /* ===============================
       Buttons & Links
       =============================== */
    .btn{
      display:inline-block;
      width:100%;
      padding:16px;
      border:0;
      border-radius:12px;
      text-align:center;
      font-weight:700;
      letter-spacing:.4px;
      cursor:pointer;
      transition:transform .15s, box-shadow .15s, opacity .15s, background .2s, color .2s;
    }

    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    .btn-primary{
      color:#fff;
      background:linear-gradient(135deg,var(--brand),var(--brand-2));
      box-shadow:0 6px 24px var(--brand-glow);
    }

    .btn-primary:hover:not(:disabled){ transform:translateY(-1px); }

    .btn-primary:focus-visible{
      outline:2px solid var(--brand);
      outline-offset:3px;
    }

    .nav{ text-align:center; margin-top:10px; }

    .link{
      display:inline-block;
      padding:12px 16px;
      border-radius:10px;
      border:1px solid var(--glass-hr);
      background:rgba(255,255,255,.06);
      color:#e5e7eb;
      text-decoration:none;
      font-weight:700;
      transition:transform .15s, box-shadow .2s, border-color .2s, color .2s;
    }

    .link:hover{
      transform:translateY(-1px);
      border-color:var(--brand);
      color:#fff;
      box-shadow:0 0 8px var(--brand-glow);
    }

    .link:focus-visible{
      outline:2px solid var(--brand);
      outline-offset:3px;
    }

    /* ===============================
       Messages
       =============================== */
    .msg{
      display:none;
      padding:12px;
      border-radius:10px;
      font-weight:700;
      text-align:center;
      margin-bottom:12px;
    }

    /* Keep success as green for clarity */
    .msg.ok{
      display:block;
      background:linear-gradient(135deg,#00d084,#00a66a);
      color:#000;
    }

    .msg.err{
      display:block;
      background:linear-gradient(135deg,#ff6b6b,#ee5a52);
      color:#fff;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="logo">CQS Admin</div>
    <div class="sub">Add a new Location (type twice to confirm)</div>

    <div id="message" class="msg"></div>

    <div class="card">
      <label for="adminCode">Admin Code</label>
      <input id="adminCode" type="password" placeholder="Enter admin code" autocomplete="one-time-code" required />

      <label for="loc1">Location / Company (UPPERCASE)</label>
      <input id="loc1" type="text" placeholder="e.g., ACME CONSTRUCTION" required />

      <label for="loc2">Confirm Location (type again)</label>
      <input id="loc2" type="text" placeholder="Type it again exactly" required />

      <button id="saveBtn" class="btn btn-primary" disabled>Add Location</button>
    </div>

    <div class="nav">
      <a class="link" href="/index.html">← Back to Home</a>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const adminCode = $('adminCode');
    const loc1 = $('loc1');
    const loc2 = $('loc2');
    const btn = $('saveBtn');
    const msg = $('message');

    function showMsg(t, ok=true){
      msg.className = 'msg ' + (ok ? 'ok' : 'err');
      msg.textContent = t;
      msg.style.display = 'block';
      setTimeout(()=> msg.style.display = 'none', 5000);
    }

    // Force ALL CAPS as user types
    [loc1, loc2].forEach(inp => {
      inp.addEventListener('input', () => {
        const pos = inp.selectionStart;
        inp.value = inp.value.toUpperCase();
        inp.setSelectionRange(pos, pos);
        enable();
      });
    });

    ['input','change'].forEach(evt => {
      adminCode.addEventListener(evt, enable);
      loc1.addEventListener(evt, enable);
      loc2.addEventListener(evt, enable);
    });

    function enable(){
      btn.disabled = !(adminCode.value.trim() && loc1.value.trim() && loc2.value.trim());
    }

    btn.onclick = async () => {
      btn.disabled = true;
      btn.textContent = 'Saving…';
      try{
        const body = {
          code: adminCode.value.trim(),
          name: loc1.value.trim(),
          confirm: loc2.value.trim()
        };
        const r = await fetch('/api/admin/locations', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        const j = await r.json();
        if (!r.ok || !j.ok) throw new Error(j.error || 'Failed to add location');
        showMsg('✅ Location added: ' + j.name, true);

        // Reset fields
        loc1.value = '';
        loc2.value = '';
      }catch(e){
        console.error(e);
        showMsg('❌ ' + e.message, false);
      }finally{
        btn.textContent = 'Add Location';
        enable();
      }
    };

    enable();
  </script>
</body>
</html>
